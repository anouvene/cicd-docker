#version: '3.9'
services:
  node-api:
    image: ghcr.io/anouvene/cicd-docker/node-api:latest
    ports:
      - '3000:80'
  frontend:
    image: ghcr.io/anouvene/cicd-docker/frontend:latest
    ports:
      - '80:80'
  
  cypress:
    build:
      context: .
      dockerfile: Dockerfile.cypress
    working_dir: /frontend
    volumes:
      - ./frontend/cypress:/frontend/cypress
      - ./frontend/cypress.config.cjs:/frontend/cypress.config.cjs
      - ./frontend/package.json:/frontend/package.json
    environment:
      - RUN_ENV=docker
    depends_on:
      - frontend
      - node-api
    entrypoint: >
      sh -c "npx cypress run --headless --browser chrome --env RUN_ENV=docker --config-file /frontend/cypress.config.cjs"
      entrypoint: >
